version: 0.2

phases:
  pre_build:
    commands:
      - start-dockerd

  build:
    commands:
      - IGNORE_COVERAGE=-

      # slow tests
      - start_time=`date +%s`
      - execute-command-if-has-matching-changes "tox -e py36,py37,py38 -- tests/integ -m slow_test -n 16 --durations 0" "tests/integ" "tests/data" "tests/conftest.py" "tests/__init__.py" "src/*.py" "setup.py" "setup.cfg" "buildspec-slowtests.yml"
      - ./ci-scripts/displaytime.sh 'py36,py37,py38 slow tests' $start_time
